<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Examples of Using CrashRptProbe API</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="style.css" rel="stylesheet" type="text/css">
<link rel="icon" href="../favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="$relpath/search.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<div style="padding:10px">
<table border="0" bgcolor="#FFFFFF" cellspacing="5" width="100%">
 <tr>
  <td width="24px" rowspan="2"><img src="../logo.png" alt="Logo" /></td>
  <td><font family="Arial" size="+2">crashrpt</font></td>
  <td rowspan="2" align="right"></td>
 </tr>
 <tr>
  <td colspan="2"><span style="font-size:0.9em"><i>A crash reporting system for Windows applications</i></a></td>
 </tr>
</table>
</div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">CrashRpt Documentation</a></li><li class="navelem"><a class="el" href="using_error_reports.html">Using Error Reports</a></li><li class="navelem"><a class="el" href="automating_crash_report_processing.html">Automating Crash Report Processing</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Examples of Using CrashRptProbe API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page contains several examples of using CrashRptProbe API described in <a class="el" href="using_crashrptprobe_api.html">Using CrashRptProbe API</a>.</p>
<h1><a class="anchor" id="opening_an_error_report"></a>
Opening Error Report</h1>
<p>The following example shows how to open an error report file: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//...</span></div><div class="line">  </div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport = 0;</div><div class="line"><span class="keywordtype">int</span> nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga6321942ac8b4635b13300df5219cac6e">crpOpenErrorReport</a>(</div><div class="line">               _T(<span class="stringliteral">&quot;0b3b0c1b-3450-4c39-9459-42221ae66460.zip&quot;</span>), <span class="comment">// Zip archive name</span></div><div class="line">               _T(<span class="stringliteral">&quot;2e4345603454a345064371ab34195316&quot;</span>), <span class="comment">// MD5 hash for the file</span></div><div class="line">               _T(<span class="stringliteral">&quot;D:\\MyApp\\1.3.4\\Sym; D:\\MyApp\\1.3.5\\Sym&quot;</span>), <span class="comment">// Where to look for symbols</span></div><div class="line">               0, <span class="comment">// Reserved</span></div><div class="line">               &amp;hReport</div><div class="line">               );</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>(nResult!=0) <span class="comment">// Check the result</span></div><div class="line">{</div><div class="line">  <span class="comment">// Get the error message</span></div><div class="line">  TCHAR szErrorMsg[256];</div><div class="line">  <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0d9c05a90d82156c237f6d50bb2157c6">crpGetLastErrorMsg</a>(szErrorMsg, 256);</div><div class="line">  <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Read the properties, extract files...</span></div><div class="line"></div><div class="line"><span class="comment">// Finally, close the report</span></div><div class="line"><a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e7fd985622aae142ead686d5380c6c5">crpCloseErrorReport</a>(hReport);</div></div><!-- fragment --><h1><a class="anchor" id="gettion_row_count"></a>
Getting Row Count in a Table</h1>
<p>The following example shows how to get count of rows in a table.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport; <span class="comment">// We assume this variable </span></div><div class="line">                   <span class="comment">// contains handle to opened error report.</span></div><div class="line"></div><div class="line"><span class="comment">// Get row count in the CRP_TBL_XMLDESC_MISC table. </span></div><div class="line"><span class="comment">// This table contains miscellaneous info loaded from XML descriptor file.</span></div><div class="line"><span class="keywordtype">int</span> nRowCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a06fd07f7a9ad9d549708aa3bedb68061">CRP_TBL_XMLDESC_MISC</a>, </div><div class="line">                    <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div><div class="line">assert(nRowCount==1); <span class="comment">// This table should always contain single row.</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Get row count in the CRP_TBL_MDMP_MODULES table. </span></div><div class="line"><span class="comment">// This table contains the list of modules loaded from minidump file.</span></div><div class="line">nRowCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>, </div><div class="line">                    <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div></div><!-- fragment --><h1><a class="anchor" id="getting_misc_info"></a>
Getting Miscellaneous Information about Error Report</h1>
<p>The following example shows how to get miscellaneous information from <a class="el" href="_crash_rpt_probe_8h.html#a06fd07f7a9ad9d549708aa3bedb68061">CRP_TBL_XMLDESC_MISC</a> and <a class="el" href="_crash_rpt_probe_8h.html#ad001f9f10bafbacf60c9c2f6b06b796d">CRP_TBL_MDMP_MISC</a> tables.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport; <span class="comment">// We assume this variable </span></div><div class="line">                   <span class="comment">// contains handle to opened error report.</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> BUFF_SIZE = 1024;</div><div class="line">TCHAR szBuffer[BUFF_SIZE];</div><div class="line"></div><div class="line"><span class="comment">// Get the CrashRpt version</span></div><div class="line"><span class="keywordtype">int</span> nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a06fd07f7a9ad9d549708aa3bedb68061">CRP_TBL_XMLDESC_MISC</a>,</div><div class="line">  <a class="code" href="_crash_rpt_probe_8h.html#a9d54fafc774b44f11c62bdf2094f6483">CRP_COL_CRASHRPT_VERSION</a>, 0, szBuffer, BUFF_SIZE, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Get the name of the application </span></div><div class="line">nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a06fd07f7a9ad9d549708aa3bedb68061">CRP_TBL_XMLDESC_MISC</a>,</div><div class="line">  <a class="code" href="_crash_rpt_probe_8h.html#ac016feb498b37c39f603461718fd7961">CRP_COL_APP_NAME</a>, 0, szBuffer, BUFF_SIZE, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Get the exception address</span></div><div class="line">nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#ad001f9f10bafbacf60c9c2f6b06b796d">CRP_TBL_MDMP_MISC</a>,</div><div class="line">  <a class="code" href="_crash_rpt_probe_8h.html#addd0dbd38130b8de54b55a0c60577064">CRP_COL_EXCEPTION_ADDRESS</a>, 0, szBuffer, BUFF_SIZE, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Get the exception thread ROWID</span></div><div class="line">nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#ad001f9f10bafbacf60c9c2f6b06b796d">CRP_TBL_MDMP_MISC</a>,</div><div class="line">  <a class="code" href="_crash_rpt_probe_8h.html#aa4ef51827e7229e738f87a47dd432bff">CRP_COL_EXCEPTION_THREAD_ROWID</a>, 0, szBuffer, BUFF_SIZE, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Convert string to int</span></div><div class="line"><span class="keywordtype">int</span> nExceptionThreadRowId = _ttoi(szBuffer);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>(nResult==0)</div><div class="line">{</div><div class="line">  <span class="comment">// Get the exception thread ID</span></div><div class="line">  nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a57c9d3fe736ed0f2b77f22422a865c06">CRP_TBL_MDMP_THREADS</a>,</div><div class="line">    <a class="code" href="_crash_rpt_probe_8h.html#aaafd0bdebd39e932c003b954bc9e43f7">CRP_COL_THREAD_ID</a>, nExceptionThreadRowId, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  </div><div class="line">  <span class="comment">// Get stack trace for the exception thread.</span></div><div class="line">  <span class="comment">// See the section below to learn how to enumerate stack frames.</span></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="enumerating_threads"></a>
Enumerating Threads and Loading Stack Trace for Each Thread</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport; <span class="comment">// We assume this variable </span></div><div class="line">                   <span class="comment">// contains handle to opened error report.</span></div><div class="line"></div><div class="line"><span class="comment">// Get row count in the CRP_TBL_MDMP_THREADS table.</span></div><div class="line"><span class="keywordtype">int</span> nThreadCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a57c9d3fe736ed0f2b77f22422a865c06">CRP_TBL_MDMP_THREADS</a>, </div><div class="line">                    <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Enumerate threads</span></div><div class="line"><span class="keywordtype">int</span> i;</div><div class="line"><span class="keywordflow">for</span>(i=0; i&lt;nThreadCount; i++)</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> BUFF_SIZE = 1024;</div><div class="line">  TCHAR szThreadID[BUFF_SIZE];     <span class="comment">// Here we will store thread ID</span></div><div class="line">  TCHAR szStackTableID[BUFF_SIZE]; <span class="comment">// Here we will store stack trace </span></div><div class="line">                                   <span class="comment">// table ID for a thread.</span></div><div class="line">  TCHAR szBuffer[BUFF_SIZE]; </div><div class="line"></div><div class="line">  <span class="comment">// Get thread ID.</span></div><div class="line">  <span class="keywordtype">int</span> nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a57c9d3fe736ed0f2b77f22422a865c06">CRP_TBL_MDMP_THREADS</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#aaafd0bdebd39e932c003b954bc9e43f7">CRP_COL_THREAD_ID</a>, i, szThreadID, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);</div><div class="line"></div><div class="line">  <span class="comment">// Get stack trace table ID for this thread.</span></div><div class="line">  nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a57c9d3fe736ed0f2b77f22422a865c06">CRP_TBL_MDMP_THREADS</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#aca6b2a52907531385b9e46592d2435a7">CRP_COL_THREAD_STACK_TABLEID</a>, i, szStackTableID, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);</div><div class="line"></div><div class="line">  <span class="comment">// Get row count in the stack trace table.</span></div><div class="line">  <span class="keywordtype">int</span> nFrameCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, szStackTableID, </div><div class="line">                      <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div><div class="line"></div><div class="line">  <span class="keywordtype">int</span> j;</div><div class="line">  <span class="keywordflow">for</span>(j=0; j&lt;nFrameCount; j++)</div><div class="line">  {</div><div class="line">    <span class="comment">// Get the row ID of the module for this stack frame.</span></div><div class="line">    nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, szStackTableID,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#acfe4f1c042765f598f561682dd58aa4d">CRP_COL_STACK_MODULE_ROWID</a>, j, szStackTableID, BUFF_SIZE, NULL);</div><div class="line">    <span class="keywordflow">if</span>(nResult==0)</div><div class="line">    {</div><div class="line">      <span class="comment">// Convert row ID to int</span></div><div class="line">      <span class="keywordtype">int</span> nModuleRowID = _ttoi(szBuffer);</div><div class="line"></div><div class="line">      <span class="comment">// Get the module name from CRP_MDMP_MODULES table.</span></div><div class="line">      nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>,</div><div class="line">                      <a class="code" href="_crash_rpt_probe_8h.html#a965d1dfd2cb14cdd5b26cead80692e99">CRP_COL_MODULE_NAME</a>, nModuleRowID, szBuffer, BUFF_SIZE, NULL);            </div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="comment">// Get the symbol name for this stack frame ().</span></div><div class="line">    nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, szStackTableID,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a2f18d540568e12f72e3d41aaf38b4f95">CRP_COL_STACK_SYMBOL_NAME</a>, j, szStackTableID, BUFF_SIZE, NULL);</div><div class="line">    assert(nResult==0);</div><div class="line">    </div><div class="line">    <span class="comment">// Check if we have valid symbol name for this stack trace.</span></div><div class="line">    <span class="keywordflow">if</span>(_tcscmp(szBuffer, _T(<span class="stringliteral">&quot;&quot;</span>))!=0)</div><div class="line">    {</div><div class="line">      <span class="comment">// We have a symbol loaded for this stack frame.</span></div><div class="line">      <span class="comment">// Get the offset in symbol.</span></div><div class="line">      nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, szStackTableID,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a296fa91c1ec2d448c9477aa7ef9925d0">CRP_COL_STACK_OFFSET_IN_SYMBOL</a>, j, szStackTableID, BUFF_SIZE, NULL);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <span class="comment">// We do not have symbol loaded for this stack frame, but we can</span></div><div class="line">      <span class="comment">// get the program counter CPU register address for this stack frame.</span></div><div class="line">      nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, szStackTableID,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#aa27c745dc1550285f7f5d1e7a436e3ca">CRP_COL_STACK_ADDR_PC_OFFSET</a>, j, szStackTableID, BUFF_SIZE, NULL);</div><div class="line">    }       </div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="enumerating_modules"></a>
Enumerating Loaded Modules</h1>
<p>The following examples shows how to enumerate loaded modules.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport; <span class="comment">// We assume this variable </span></div><div class="line">                   <span class="comment">// contains handle to opened error report.</span></div><div class="line"></div><div class="line"><span class="comment">// Get row count in the CRP_TBL_MDMP_MODULES table.</span></div><div class="line"><span class="keywordtype">int</span> nRowCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>, </div><div class="line">                    <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Enumerate modules</span></div><div class="line"><span class="keywordtype">int</span> i;</div><div class="line"><span class="keywordflow">for</span>(i=0; i&lt;nRowCount; i++)</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> BUFF_SIZE = 1024;</div><div class="line">  TCHAR szBuffer[BUFF_SIZE];</div><div class="line"></div><div class="line">  <span class="comment">// Get module name.</span></div><div class="line">  <span class="keywordtype">int</span> nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a965d1dfd2cb14cdd5b26cead80692e99">CRP_COL_MODULE_NAME</a>, i, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);</div><div class="line"></div><div class="line">  <span class="comment">// Get module image name.</span></div><div class="line">  nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a4a8ca26a5492dd05f0fbbbe3e78dc601">CRP_COL_MODULE_IMAGE_NAME</a>, i, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);</div><div class="line"></div><div class="line">  <span class="comment">// Get module PDB file name (can be used to determine if symbols were</span></div><div class="line">  <span class="comment">// loaded for this module).</span></div><div class="line">  nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#af6846fd2538956b0f7fba6f1b2ce7d8f">CRP_TBL_MDMP_MODULES</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#af535cc949670edfadd168f197d9893d5">CRP_COL_MODULE_LOADED_PDB_NAME</a>, i, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);  </div><div class="line">                                           </div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="enumerating_file_items"></a>
Enumerating and Extracting Files Contained in Error Report</h1>
<p>The following example shows how to enumerate files contained in the error report and extract them.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_crash_rpt_probe_8h.html">CrashRptProbe.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="_crash_rpt_probe_8h.html#a2b2d28276d67dd476ea8aa9c45669d82">CrpHandle</a> hReport; <span class="comment">// We assume this variable </span></div><div class="line">                   <span class="comment">// contains handle to opened error report.</span></div><div class="line"></div><div class="line"><span class="comment">// Get row count in the CRP_TBL_XMLDESC_FILE_ITEMS table.</span></div><div class="line"><span class="keywordtype">int</span> nRowCount = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a8c66617a7f801165edb294da48c5575b">CRP_TBL_XMLDESC_FILE_ITEMS</a>, </div><div class="line">                    <a class="code" href="_crash_rpt_probe_8h.html#a37d896e593fa4667d38907b2adb98372">CRP_META_ROW_COUNT</a>, 0, NULL, 0, NULL);</div><div class="line"></div><div class="line"><span class="comment">// Enumerate file items</span></div><div class="line"><span class="keywordtype">int</span> i;</div><div class="line"><span class="keywordflow">for</span>(i=0; i&lt;nRowCount; i++)</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> BUFF_SIZE = 1024;</div><div class="line">  TCHAR szBuffer[BUFF_SIZE];</div><div class="line"></div><div class="line">  <span class="comment">// Get file item name</span></div><div class="line">  <span class="keywordtype">int</span> nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a8c66617a7f801165edb294da48c5575b">CRP_TBL_XMLDESC_FILE_ITEMS</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a3812964f7e0aedfbc71b7f0ecf88d617">CRP_COL_FILE_ITEM_NAME</a>, i, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  <span class="keywordflow">if</span>(nResult==0)</div><div class="line">  {</div><div class="line">    <span class="comment">// Extract file overwriting if such file already exists</span></div><div class="line">    <span class="keywordtype">int</span> nExtract = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga237fcf61f3027bb315c54bf82e3779d2">crpExtractFile</a>(hReport, szBuffer, szBuffer, TRUE);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Get file item description </span></div><div class="line">  nResult = <a class="code" href="group___crash_rpt_probe_a_p_i.html#ga0e45570a3b25c6c5f8971b3179c5fdbf">crpGetProperty</a>(hReport, <a class="code" href="_crash_rpt_probe_8h.html#a8c66617a7f801165edb294da48c5575b">CRP_TBL_XMLDESC_FILE_ITEMS</a>,</div><div class="line">                 <a class="code" href="_crash_rpt_probe_8h.html#a9ac7d60a02510e1e2b4c045f4c0b1f53">CRP_COL_FILE_ITEM_DESCRIPTION</a>, i, szBuffer, BUFF_SIZE, NULL);</div><div class="line">  assert(nResult==0);</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<hr size="1"><address style="text-align: right;"><small>
Generated on Fri Apr 21 2017 15:24:31 for CrashRpt by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.13</small></address>
</body>
</html>
