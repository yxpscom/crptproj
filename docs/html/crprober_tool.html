<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Using crprober.exe Tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="style.css" rel="stylesheet" type="text/css">
<link rel="icon" href="../favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="$relpath/search.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<div style="padding:10px">
<table border="0" bgcolor="#FFFFFF" cellspacing="5" width="100%">
 <tr>
  <td width="24px" rowspan="2"><img src="../logo.png" alt="Logo" /></td>
  <td><font family="Arial" size="+2">crashrpt</font></td>
  <td rowspan="2" align="right"></td>
 </tr>
 <tr>
  <td colspan="2"><span style="font-size:0.9em"><i>A crash reporting system for Windows applications</i></a></td>
 </tr>
</table>
</div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">CrashRpt Documentation</a></li><li class="navelem"><a class="el" href="using_error_reports.html">Using Error Reports</a></li><li class="navelem"><a class="el" href="automating_crash_report_processing.html">Automating Crash Report Processing</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using crprober.exe Tool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Since v1.2.0</b>, CrashRpt provides a tool named <b>crprober.exe</b> that can be used for automating crash report processing. To run the tool, go to <code>bin</code> directory and type <b>crprober.exe</b> in the command line.</p>
<dl class="section note"><dt>Note</dt><dd>If you run the precompiled tool from <code>bin</code> folder and do not compile it yourself, you might experience some problems if Visual C++ 2010 Redistributable files are not installed on your machine. There may be error messages like 'The application configuration is incorrect' and so on. If you do not have Visual C++ 2010 Redistributable on your machine and do not want to install it, please compile the solution yourself as described in <a class="el" href="compiling_crashrpt.html">Compiling CrashRpt</a>.</dd></dl>
<p>Note that <b>crprober.exe</b> shouldn't be distributed to end users. They just won't be able to use it without symbol files.</p>
<p>The tool can be used to open error report files generated by any version of CrashRpt. However it works the best with reports created by version 1.1 and higher.</p>
<p>Typically an error report file contains an associated MD5 hash file. The crprober tool can perform integrity check using the MD5 hash file. When you receive a report using HTTP connection, the MD5 hash can be retrieved from 'md5' script argument. When you receive a report using E-mail, the hash is attached to the mail message. For more information, see <a class="el" href="sending_error_reports.html">Sending Error Reports</a>.</p>
<p>The tool extracts information about the error report (its GUID, version of CrashRpt that generated the report, creation time in UTC format), the information about the application that sent the report (name, version, path to executable file, the list of loaded modules), information about the operating system (name, version, service pack, CPU info), and information about the exception (exception address, exception code, stack trace). It presents the extracted information in text form (creates a text file or writes to the terminal).</p>
<p>The error report can't be processed properly without symbol files (*.PDB) generated by Visual Studio for your application. You typically store the symbol files locally when preparing to software release. For more information, see <a class="el" href="preparing_to_software_release.html">Preparing to Software Release</a>.</p>
<p>The <b>crprober.exe</b> is a console tool. It accepts several command line arguments. The arguments are listed in the table below: </p><table class="doxtable">
<tr>
<td><b>Name</b> </td><td><p class="starttd"><b>Description</b> </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/? </td><td><p class="starttd">Prints the usage help.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/f &lt;input_file&gt; </td><td><p class="starttd">Required. Absolute or relative path to input ZIP file name.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/fmd5 &lt;md5_file_or_dir&gt; </td><td><p class="starttd">Optional. Path to .md5 file containing MD5 hash for the &lt;input_file&gt; or directory name where to search for the .md5 file. If this parameter is omitted, the .md5 file is searched in the directory where &lt;input_file&gt; is located.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/o &lt;out_file_or_dir&gt; </td><td><p class="starttd">Optional. Output file name or directory name. Or use empty name "" to direct output to terminal. If this parameter is omitted, output is not generated.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/sym &lt;sym_search_dirs&gt; </td><td><p class="starttd">Optional. Symbol files search directory or list of directories separated with semicolon. If this parameter is omitted, symbol files are searched using the default search sequence.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/ext &lt;extract_dir&gt; </td><td><p class="starttd">Optional. Specifies the directory where to extract all files contained in error report. If this parameter is omitted, files are not extracted.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>/get &lt;table_id&gt; &lt;column_id&gt; &lt;row_id&gt; </td><td>Optional. Specifies the table ID, column ID and row index of the property to retrieve. If this parameter specified, the property is written to the output file or to terminal, as defined by /o parameter. For the list of properties you can retrieve, see <a class="el" href="using_crashrptprobe_api.html">Using CrashRptProbe API</a>. </td></tr>
</table>
<p>The crprober tool can return one of the following return codes:</p>
<table class="doxtable">
<tr>
<td><b> Return Code</b> </td><td><p class="starttd"><b>Meaning</b> </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>0 </td><td><p class="starttd">OK.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>1 </td><td><p class="starttd">Unexpected error.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>2 </td><td><p class="starttd">Invalid command line argument. Ensure you pass correct parameters.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>3 </td><td><p class="starttd">Integrity check failed (MD5 hash mismatch)</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>4 </td><td><p class="starttd">Error extracting file. Ensure the extraction path is correct.</p>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="crprober_examples"></a>
Examples of Use</h1>
<p>The following example processes the 'error_report.zip' file and writes output to the terminal. Symbol files are assumed to be located in 'D:\Symbol Files' directory. </p><div class="fragment"><div class="line">crprober.exe /f error_report.zip /o <span class="stringliteral">&quot;&quot;</span> /sym <span class="stringliteral">&quot;D:\Symbol Files&quot;</span></div></div><!-- fragment --><p>The following example opens 'error_report.zip' file located in the current directory, performs integrity check using 'error_report.zip.md5' file and writes output to the 'error_report.zip.txt' file. Symbol files are assumed to be located in 'D:\Symbol Files' or in 'D:\MyApp\sym' directory. </p><div class="fragment"><div class="line">crprober.exe /f error_report.zip /md5 error_report.zip.md5 /o error_report.zip.txt /sym <span class="stringliteral">&quot;D:\Symbol Files;D:\MyApp\sym&quot;</span></div></div><!-- fragment --><p>The following example retrieves the application name from the error report and writes it to terminal: </p><div class="fragment"><div class="line">crprober.exe /f error_report.zip /o <span class="stringliteral">&quot;&quot;</span> /sym <span class="stringliteral">&quot;D:\Symbol Files;D:\MyApp\sym&quot;</span> /<span class="keyword">get</span> XmlDescMisc AppName 0</div></div><!-- fragment --><p>The following example retrieves the count of rows in the MdmpModules table and writes it to terminal: </p><div class="fragment"><div class="line">crprober.exe /f error_report.zip /o <span class="stringliteral">&quot;&quot;</span> /sym <span class="stringliteral">&quot;D:\Symbol Files;D:\MyApp\sym&quot;</span> /<span class="keyword">get</span> MdmpModules RowCount 0</div></div><!-- fragment --><h1><a class="anchor" id="crprober_reallife_scenario"></a>
Real-Life Usage Scenario</h1>
<p>Let's assume you receive error reports over E-mail. To automate error reports extraction from E-mail attachments, you may use some extension of your mail program. For example, if you use Mozilla Thunderbird, you can use <a href="http://www.eviljeff.com/?page=moz-extensions">Attachment Extractor extension</a>. You can configure the extension to determine the error report messages on the fly and extract email attachments (ZIP and MD5 files) to some folder.</p>
<p>When you have ZIP and MD5 files stored in the directory, you may want to process them all at once. You may want to process reports from the latest version of your application, ignoring all others. You may want to group similar error reports, for example, by stack trace of the exception thread. You may want to copy processed reports to some other directory, leaving not processed reports where they are. You also may want to move corrupted error reports to some folder, to move error reports not having exception information to another folder, and error reports not having symbols loaded for any stack frame to the third folder. You can automate this task using a batch (BAT) script.</p>
<p>Below an example batch script is presented (you can find the script in processing\scripts\postprocess.bat file).</p><ul>
<li>The script recursively searches <em>INPUT_DIR</em> folder and processes files matching the pattern defined by <em>INPUT_FILE_PATTERN</em> variable. For example, "*.zip" pattern means to process all ZIP files in a directory.</li>
<li>The script accepts only reports having application name as defined by <em>ACCEPTABLE_APPNAME</em> variable. Keep this empty to accept all appnames.</li>
<li>The script accepts only reports having application version as defined by <em>ACCEPTABLE_APPVERSION</em> variable. Keep this empty to accept all app versions.</li>
<li>The script searches for symbol files in <em>SYM_SEARCH_DIRS</em>. This may be semicolon-separated list of directories.</li>
<li>The script saves processed reports and output text files to <em>SAVE_RESULTS_TO_DIR</em> directory. It groups error reports by similar stack traces, placing them to a single subfolder. Error reports not having exception information are placed into NoExceptionInfo subfolder, and error reports not having symbols loaded for any stack trace are placed to NoSymbolsLoaded subfolder.</li>
<li>The script moves corrupted error reports to the folder defined by <em>SAVE_INVALID_REPORTS_TO_DIR</em> parameter.</li>
</ul>
<div class="fragment"><div class="line">@echo off</div><div class="line">rem Process a group of ZIP error report files</div><div class="line"></div><div class="line">set INPUT_DIR=&quot;E:\ErrorReports&quot;</div><div class="line">set INPUT_FILE_PATTERN=&quot;*.zip&quot;</div><div class="line">set ACCEPTABLE_APPNAME=&quot;CrashRpt Tests&quot;</div><div class="line">set ACCEPTABLE_APPVERSION=&quot;1.2.0&quot;</div><div class="line">set SYM_SEARCH_DIRS=&quot;D:\Projects\CrashRpt\CrashRptSaved\1.2.0&quot;</div><div class="line">set SAVE_RESULTS_TO_DIR=&quot;valid_reports\&quot;</div><div class="line">set SAVE_INVALID_REPORTS_TO_DIR=&quot;invalid_reports\&quot;</div><div class="line">set CRPROBER_PATH=&quot;D:\Projects\CrashRpt\bin\crprober.exe&quot;</div><div class="line"></div><div class="line">mkdir %SAVE_RESULTS_TO_DIR%</div><div class="line"></div><div class="line">for /R %INPUT_DIR% %%f in ( %INPUT_FILE_PATTERN% ) do call :process_report &quot;%%f&quot;</div><div class="line">erase temp.txt</div><div class="line">exit </div><div class="line"></div><div class="line">:process_report</div><div class="line"></div><div class="line">  echo Processing file: %1</div><div class="line"></div><div class="line">  if %ACCEPTABLE_APPNAME%==&quot;&quot; goto appname_ok</div><div class="line">  rem Get application name from the crash report file and write it to &quot;temp.txt&quot;</div><div class="line">  %CRPROBER_PATH% /f %1 /o &quot;temp.txt&quot; /get XmlDescMisc AppName 0</div><div class="line">  if not %errorlevel%==0 goto failed</div><div class="line"> </div><div class="line">  set /p app_name=&lt;temp.txt</div><div class="line">  if &quot;%app_name%&quot;==%ACCEPTABLE_APPNAME% goto appname_ok</div><div class="line">  goto done</div><div class="line"></div><div class="line">:appname_ok</div><div class="line"></div><div class="line">  if %ACCEPTABLE_APPVERSION%==&quot;&quot; goto appversion_ok</div><div class="line">  rem Get application version from the crash report file and write it to &quot;temp.txt&quot;</div><div class="line">  %CRPROBER_PATH% /f %1 /o &quot;temp.txt&quot; /get XmlDescMisc AppVersion 0</div><div class="line">  if not %errorlevel%==0 goto failed</div><div class="line"> </div><div class="line">  set /p app_version=&lt;temp.txt</div><div class="line">  if &quot;%app_version%&quot;==%ACCEPTABLE_APPVERSION% goto appversion_ok</div><div class="line"></div><div class="line">  goto done</div><div class="line"></div><div class="line">:appversion_ok</div><div class="line"></div><div class="line">  set stack_md5=NoExceptionInfo</div><div class="line">  %CRPROBER_PATH% /f %1 /o &quot;temp.txt&quot; /sym %SYM_SEARCH_DIRS%  /get MdmpMisc ExceptionThreadStackMD5 0</div><div class="line">  if not %errorlevel%==0 goto save_results</div><div class="line">  set /p stack_md5=&lt;temp.txt</div><div class="line">  erase temp.txt</div><div class="line"></div><div class="line">  if %stack_md5%==&quot;&quot; set stack_md5=NoSymbolsLoaded</div><div class="line"></div><div class="line">:save_results</div><div class="line"></div><div class="line">  mkdir %SAVE_RESULTS_TO_DIR%%stack_md5%</div><div class="line">  </div><div class="line"></div><div class="line">  rem Process report and write results to text file</div><div class="line">  %CRPROBER_PATH% /f %1 /o %1.txt /sym %SYM_SEARCH_DIRS% </div><div class="line">  echo Return code=%errorlevel%</div><div class="line">  if not %errorlevel%==0 goto failed</div><div class="line"></div><div class="line">:ok</div><div class="line">  move %1 %SAVE_RESULTS_TO_DIR%%stack_md5%</div><div class="line">  move %1.txt %SAVE_RESULTS_TO_DIR%%stack_md5%</div><div class="line">  goto done</div><div class="line"></div><div class="line">:failed</div><div class="line"></div><div class="line"> mkdir %SAVE_INVALID_REPORTS_TO_DIR%</div><div class="line"> move %1 %SAVE_INVALID_REPORTS_TO_DIR%</div><div class="line"> </div><div class="line">:done</div><div class="line">  </div><div class="line">rem Return from subroutine</div><div class="line">goto :eof</div></div><!-- fragment --><p>When the script finishes, you will have similar error reports groupped in subfolders. The question is what group to start to analyze first? What groups contain the reports of errors occurring most often? The following simple Python script (you can find the script in processing\scripts\basic_stats.py file) can help you to answer this question by getting the count of .txt files in each subfolder and outputting the results into the text file.</p>
<div class="fragment"><div class="line"><span class="comment"># This script calculates how many error reports are in each subdirectory</span></div><div class="line"><span class="comment"># and how many error reports are in total.</span></div><div class="line"><span class="comment"># Edit in_dir and out_file parameters as you need.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">in_dir = <span class="stringliteral">&quot;D:/Projects/CrashRpt/valid_reports&quot;</span></div><div class="line">out_file = <span class="stringliteral">&quot;stats.txt&quot;</span></div><div class="line"></div><div class="line"></div><div class="line">f = open(out_file, <span class="stringliteral">&quot;w&quot;</span>)</div><div class="line"></div><div class="line"><span class="keyword">def </span>get_txt_file_count(dirname):</div><div class="line">   count = 0</div><div class="line">   <span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(dirname, <span class="keyword">True</span>):</div><div class="line">     <span class="keywordflow">for</span> file <span class="keywordflow">in</span> files:</div><div class="line">        <span class="keywordflow">if</span> file[-4:] != <span class="stringliteral">&quot;.txt&quot;</span>:</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        count += 1</div><div class="line">     <span class="keywordflow">break</span>;</div><div class="line">   <span class="keywordflow">return</span> count</div><div class="line"></div><div class="line">multimap = dict()</div><div class="line"><span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(in_dir):</div><div class="line">   <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> dirs:</div><div class="line">      dir_name = os.path.join(root, dir)</div><div class="line">      report_count_in_dir = get_txt_file_count(dir_name)</div><div class="line">      <span class="keywordflow">if</span> report_count_in_dir <span class="keywordflow">in</span> multimap.keys():</div><div class="line">         multimap[report_count_in_dir].append(dir)</div><div class="line">      <span class="keywordflow">else</span>:</div><div class="line">         multimap[report_count_in_dir] = [dir]</div><div class="line"></div><div class="line">ordered_list = list(multimap.keys())</div><div class="line">ordered_list.sort()</div><div class="line">ordered_list.reverse()</div><div class="line"></div><div class="line">total_count = 0</div><div class="line">total_groups = 0</div><div class="line"><span class="keywordflow">for</span> count <span class="keywordflow">in</span> ordered_list:</div><div class="line">  total_groups += len(multimap[count]);</div><div class="line">  total_count += count * len(multimap[count])</div><div class="line"></div><div class="line">f.write(<span class="stringliteral">&quot;Total %d reports (100%%) in %d directories\n&quot;</span>%(total_count, total_groups))</div><div class="line"></div><div class="line">n = 1</div><div class="line"><span class="keywordflow">for</span> key <span class="keywordflow">in</span> ordered_list:</div><div class="line">  <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> multimap[key]:</div><div class="line">   percent = key/total_count*100</div><div class="line">   f.write(<span class="stringliteral">&quot;%d. %d reports (%0.1f%%) in &#39;%s&#39;\n&quot;</span>%(n, key, percent, dir))</div><div class="line">   n = n+1</div><div class="line"></div><div class="line">f.close()</div></div><!-- fragment --><p>The expected script output:</p>
<div class="fragment"><div class="line">207 error reports in total</div><div class="line">105 error reports in <span class="stringliteral">&#39;subdir1&#39;</span></div><div class="line">50 error reports in <span class="stringliteral">&#39;subdir2&#39;</span></div><div class="line">30 error reports in <span class="stringliteral">&#39;subdir3&#39;</span></div><div class="line">20 error reports in <span class="stringliteral">&#39;subdir4&#39;</span></div><div class="line">2 error reports in <span class="stringliteral">&#39;subdir5&#39;</span></div></div><!-- fragment --><p>So, the 'subdir1' contains the reports about an error reported the most often. And the 'subdir5' contains the reports about an error reported the most rare. </p>
</div></div><!-- contents -->
<hr size="1"><address style="text-align: right;"><small>
Generated on Fri Apr 21 2017 15:24:31 for CrashRpt by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.13</small></address>
</body>
</html>
